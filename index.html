<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>AES File Encryptor/Decryptor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body class="bg-light">
<div class="container mt-5">
  <h2 class="text-center mb-4">üîê AES File Encryptor / Decryptor</h2>
  
  <!-- Ph·∫ßn m√£ h√≥a -->
  <div class="mb-4">
    <h4>M√£ h√≥a</h4>
    <div class="mb-3">
      <label for="key" class="form-label">üîë Nh·∫≠p kh√≥a (t·ª± do ƒë·ªô d√†i):</label>
      <input type="text" class="form-control" id="key" placeholder="Nh·∫≠p kh√≥a m√£ h√≥a">
    </div>
    <div class="mb-3">
      <label for="file" class="form-label">üìÇ Ch·ªçn file ƒë·ªÉ m√£ h√≥a:</label>
      <input type="file" class="form-control" id="file" accept=".txt,.jpg,.jpeg,.png,.gif">
    </div>
    <div class="d-flex justify-content-center">
      <button class="btn btn-primary" onclick="encryptFile()">M√£ h√≥a</button>
    </div>
  </div>
  <!-- Ph·∫ßn gi·∫£i m√£ -->
  <div class="mb-4">
    <h4>Gi·∫£i m√£</h4>
    <div class="mb-3">
      <label for="keyDecrypt" class="form-label">üîë Nh·∫≠p kh√≥a (t·ª± do ƒë·ªô d√†i):</label>
      <input type="text" class="form-control" id="keyDecrypt" placeholder="Nh·∫≠p kh√≥a gi·∫£i m√£">
    </div>
    <div class="mb-3">
      <label for="fileDecrypt" class="form-label">üìÇ Ch·ªçn file ƒë·ªÉ gi·∫£i m√£:</label>
      <input type="file" class="form-control" id="fileDecrypt" accept=".enc">
    </div>
    <div class="d-flex justify-content-center">
      <button class="btn btn-success" onclick="decryptFile()">Gi·∫£i m√£</button>
    </div>
  </div>
  <div id="status" class="text-center mt-4"></div>
</div>
<script>
  function readFileAsArrayBuffer(file, callback) {
    const reader = new FileReader();
    reader.onload = () => callback(reader.result);
    reader.readAsArrayBuffer(file);
  }
  function download(content, fileName) {
    const blob = new Blob([content], {type: 'application/octet-stream'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = fileName;
    a.click();
  }
  function encryptFile() {
    const fileInput = document.getElementById('file');
    const keyInput = document.getElementById('key').value;
    if (!fileInput.files.length || !keyInput) {
      alert("Vui l√≤ng ch·ªçn file v√† nh·∫≠p kh√≥a.");
      return;
    }
    readFileAsArrayBuffer(fileInput.files[0], function(content) {
      const key = CryptoJS.SHA256(keyInput);
      const iv = CryptoJS.lib.WordArray.random(16);
      const encrypted = CryptoJS.AES.encrypt(CryptoJS.lib.WordArray.create(content), key, { iv: iv }).toString();
      const finalData = iv.toString(CryptoJS.enc.Hex) + encrypted;
      download(finalData, fileInput.files[0].name + '.enc');
      document.getElementById("status").innerText = "‚úÖ File ƒë√£ ƒë∆∞·ª£c m√£ h√≥a v√† t·∫£i xu·ªëng.";
    });
  }
  function decryptFile() {
    const fileInput = document.getElementById('fileDecrypt');
    const keyInput = document.getElementById('keyDecrypt').value;
    if (!fileInput.files.length || !keyInput) {
      alert("Vui l√≤ng ch·ªçn file v√† nh·∫≠p kh√≥a.");
      return;
    }
    readFileAsArrayBuffer(fileInput.files[0], function(content) {
      try {
        const key = CryptoJS.SHA256(keyInput);
        const ivHex = String.fromCharCode.apply(null, new Uint8Array(content.slice(0, 16)));
        const encryptedData = content.slice(16);
        const iv = CryptoJS.enc.Hex.parse(ivHex);
        const decrypted = CryptoJS.AES.decrypt(CryptoJS.lib.WordArray.create(encryptedData), key, { iv: iv });
        const result = decrypted.toString(CryptoJS.enc.Utf8);
        if (!result) throw new Error("Sai kh√≥a ho·∫∑c ƒë·ªãnh d·∫°ng file.");
        download(result, fileInput.files[0].name.replace('.enc', '.dec'));
        document.getElementById("status").innerText = "‚úÖ File ƒë√£ ƒë∆∞·ª£c gi·∫£i m√£ v√† t·∫£i xu·ªëng.";
      } catch (e) {
        document.getElementById("status").innerText = "‚ùå Gi·∫£i m√£ th·∫•t b·∫°i. C√≥ th·ªÉ sai kh√≥a.";
      }
    });
  }
</script>
</body>
</html>